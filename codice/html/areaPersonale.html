<!-- 
  Progetto: Clinica Privata Torino
  Autore: Simone Sugliano
  Descrizione: Sito dimostrativo full responsive con gestione prenotazioni, database e ottimizzazione SEO.
  Tecnologie: HTML5, CSS3, JavaScript, Bootstrap, Firebase
  Data: Ottobre 2025
-->
<!DOCTYPE html>
<html lang="it">

<head>
  <!-- META BASE -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Area Personale - Clinica Privata Torino</title>

  <!-- SEO -->
  <meta name="description"
    content="Accedi alla tua area personale della Clinica Privata di Torino per gestire prenotazioni, dati e appuntamenti in modo semplice e sicuro.">
  <meta name="keywords"
    content="area personale clinica privata, login paziente, prenotazioni mediche Torino, profilo utente, accesso riservato, clinica privata Torino">
  <meta name="author" content="Clinica Privata S.r.l.">
  <meta name="theme-color" content="#ffffff">

  <!-- OPEN GRAPH -->
  <meta property="og:title" content="Area Personale - Clinica Privata Torino">
  <meta property="og:description"
    content="Accedi alla tua area personale per visualizzare prenotazioni, modificare i tuoi dati e gestire le visite presso la Clinica Privata di Torino.">
  <meta property="og:image" content="https://democlinicaprivata.altervista.org/assets/img/clinica.png">
  <meta property="og:url" content="https://democlinicaprivata.altervista.org/html/areaPersonale.html">
  <meta property="og:type" content="website">

  <!-- CANONICAL + FAVICON -->
  <link rel="canonical" href="https://democlinicaprivata.altervista.org/html/areaPersonale.html">
  <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">

  <meta name="robots" content="index, follow">
  <meta name="language" content="it">


  <!----------------------------------------------------------------------------------------------------------link-->

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- CSS personalizzato -->
  <link rel="stylesheet" href="/css/style.css">

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function () {
      //PUBLIC KEY invio mail
      emailjs.init("4hAxfzArHNF5zp1iX");
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!--sweetalert per sostituire alert -->
  <!-- script cookies iubenda -->
  <script type="text/javascript"
    src="https://embeds.iubenda.com/widgets/7a470f35-9785-4723-8fd0-7e14a683250d.js"></script>

</head>

<body>
  <!-- Navbar -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-light pt-0">
    <div class="container-xl bg-lightblue shadow-sm px-4">
      <a class="navbar-brand sfondo" href="/assets/img/clinica.png" target="_blank">
        <img src="/assets/img/logoClinica.png" alt="Logo" width="100" class="d-inline-block">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain"
        aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarMain">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="tel:+390123456789" aria-label="Chiama la clinica">
              <i class="fas fa-phone-alt text-success me-1"></i>3923688757
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../index.html#form-prenotazioni">
              <i class="fas fa-envelope text-success me-1"></i> Richiedi informazioni
            </a>
          </li>
          <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="servizi.html">Servizi</a></li>
          <li class="nav-item"><a class="nav-link" href="professionisti.html">Professionisti</a></li>
          <li class="nav-item"><a class="nav-link" href="prenota.html">Prenota</a></li>
          <li class="nav-item"><a class="nav-link" href="contatti.html">Contatti</a></li>
          <li class="nav-item"><a class="nav-link active" href="/html/areaPersonale.html">Area Personale</a></li>
          <li class="nav-item">
  <a class="nav-link" href="/html/blog.html">Blog</a>
</li>

        </ul>
      </div>
    </div>
  </nav>
  <!-- /Navbar -->

  <section class="py-5 bg-lightblue text-center" style="margin-top:72px;">
    <div class="container">
      <h1 class="fw-bold mb-4 mappa">Le mie prenotazioni</h1>
      <p class="text-muted mb-4">Visualizza e cancella le visite prenotate presso la clinica.</p>

      <!-- Campo email -->
      <div class="mb-3" style="max-width:420px; margin:auto;">
        <input type="email" id="emailCliente" class="form-control" placeholder="Inserisci la tua email">
        <button class="btn btn-success w-100 mt-2" id="btnCercaPrenotazioni">
          <i class="fa-solid fa-magnifying-glass me-1"></i> Cerca prenotazioni
        </button>
      </div>

      <!-- Contenitore risultati -->
      <div id="listaPrenotazioni" class="mt-4"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="text-dark pt-4 ">
    <div class="container-xl bg-lightblue border-top px-4">
      <div class="row gy-4 text-center text-md-start">
        <div class="col-12 col-md-3">
          <h6 class="fw-bold titfooter">SOCIAL</h6>
          <a href="https://facebook.com" class="text-decoration-none text-muted d-block footer-link" target="_blank">
            <i class="fab fa-facebook-f me-2"></i> Facebook
          </a>
          <a href="https://instagram.com" class="text-decoration-none text-muted d-block footer-link" target="_blank">
            <i class="fab fa-instagram me-2"></i> Instagram
          </a>
          <a href="https://linkedin.com" class="text-decoration-none text-muted d-block footer-link" target="_blank">
            <i class="fab fa-linkedin me-2"></i> LinkedIn
          </a>
          <!-- pulsante condividi-->
<button id="shareBtn" class="btn btn-outline-primary">
  <i class="fas fa-share-alt me-2"></i>Condividi
</button>
        </div>
        <div class="col-12 col-md-3">
          <h6 class="fw-bold titfooter">CONTATTI</h6>
          <p class="mb-1">
            <i class="fas fa-phone-alt text-success me-2"></i>
            <a href="tel:+390123456789" class="text-muted text-decoration-none footer-link">3923688757</a>
          </p>
          <p class="mb-1">
            <i class="fas fa-envelope text-success me-2"></i>
            <a href="../index.html#form-prenotazioni" class="text-muted text-decoration-none footer-link">Richiedi
              informazioni</a>
          </p>
        </div>
        <div class="col-12 col-md-3">
          <h6 class="fw-bold titfooter">INFORMAZIONI</h6>
          <p class="mb-1">P.IVA 12345678901</p>
          <a href="/html/noteLegalii.html" class="text-muted text-decoration-none d-block footer-link" target="_blank">Note
            legali</a>
          <a href="/html/privacyEcookies.html" class="text-muted text-decoration-none d-block footer-link">Privacy & Cookie</a>
           <p class="text-center text-muted small mt-4">
            ‚ö†Ô∏è Questo sito √® una demo realizzata a scopo didattico.
            I contenuti, nomi e indirizzi sono puramente fittizi.
          </p>
        </div>
        <div class="col-12 col-md-3 text-md-end text-center">
          <a class="navbar-brand sfondo d-inline-block mb-2" href="/assets/img/clinica.png" target="_blank">
            <img src="/assets/img/logoClinica.png" alt="Logo" width="100">
          </a>
          <p class="small text-muted">¬© 2025 Clinica Privata. Tutti i diritti riservati.</p>
        </div>
      </div>
    </div>
  </footer>
  <!-- /Footer -->

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ================= Firebase (compat) ================= -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    // Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA5Fj88YjMi6Krjc6k_zHWRsdTmBBmZ0fU",
      authDomain: "login-clinica-demo.firebaseapp.com",
      projectId: "login-clinica-demo",
      storageBucket: "login-clinica-demo.appspot.com",
      messagingSenderId: "865606471743",
      appId: "1:865606471743:web:ceab28c96147f864dda88a",
      measurementId: "G-LKY5ZE1GHP"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <!-- ============== /Firebase (compat) ================== -->

  <!-- ======= Script ricerca + cancellazione con email ======= -->
  <script>
    const btnCerca = document.getElementById("btnCercaPrenotazioni");
    const inputEmail = document.getElementById("emailCliente");
    const lista = document.getElementById("listaPrenotazioni");

    btnCerca.addEventListener("click", async () => {
      const email = (inputEmail.value || "").trim();
      lista.innerHTML = "";

      if (!email) {
        lista.innerHTML = `<p class="text-danger">Inserisci un'email valida.</p>`;
        return;
      }

      lista.innerHTML = `<p class="text-muted">üîç Ricerca in corso...</p>`;

      try {
        const snap = await db
          .collection("prenotazioni")
          .where("email", "==", email)
          .orderBy("timestamp", "desc")
          .get();

        if (snap.empty) {
          lista.innerHTML = `<p class="text-warning">Nessuna prenotazione trovata per <strong>${email}</strong>.</p>`;
          return;
        }

        // Costruzione tabella
        let html = `
          <div class="table-responsive mt-3">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-success">
                <tr>
                  <th>Data</th>
                  <th>Ora</th>
                  <th>Specialit√†</th>
                  <th>Medico</th>
                  <th class="text-center">Azioni</th>
                </tr>
              </thead>
              <tbody>
        `;

        snap.forEach(docSnap => {
          const d = docSnap.data();
          const id = docSnap.id;

          html += `
            <tr data-id="${id}">
              <td>${d.data}</td>
              <td>${d.ora}</td>
              <td>${d.specialita}</td>
              <td>${d.medico}</td>
              <td class="text-center">
                <button
                  class="btn btn-outline-danger btn-sm btnCancella"
                  data-id="${id}"
                  data-medico="${d.medico}"
                  data-specialita="${d.specialita}"
                  data-data="${d.data}"
                  data-ora="${d.ora}"
                >
                  <i class="fa-solid fa-trash-can me-1"></i> Cancella
                </button>
              </td>
            </tr>
          `;
        });

        html += `</tbody></table></div>`;
        lista.innerHTML = html;

        // Bind pulsanti "Cancella"
        document.querySelectorAll(".btnCancella").forEach(btn => {
          btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            const riga = btn.closest("tr");

            const result = await Swal.fire({
              title: "Vuoi davvero cancellare?",
              text: "Questa azione eliminer√† la prenotazione in modo definitivo.",
              icon: "warning",
              showCancelButton: true,
              confirmButtonColor: "#d33",
              cancelButtonColor: "#3085d6",
              confirmButtonText: "S√¨, cancella",
              cancelButtonText: "Annulla"
            });
            if (!result.isConfirmed) return;

            // disabilita bottone mentre lavora
            const oldHtml = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="spinner-border spinner-border-sm me-2"></span>Elimino...`;

            try {
              // 1) elimina su Firestore
              await db.collection("prenotazioni").doc(id).delete();

              // 2) invia email di conferma cancellazione (non blocca l'eliminazione)
              const emailDest = (inputEmail.value || "").trim();
              const payload = {
                email: emailDest,
                medico: btn.dataset.medico,
                specialita: btn.dataset.specialita,
                data: btn.dataset.data,
                ora: btn.dataset.ora
              };

              if (typeof emailjs !== "undefined") {
                emailjs.send("service_187ywqv", "template_3xp5g7h", payload)
                  .then(() => {
                    Swal.fire("‚úÖ Prenotazione cancellata.\n√à stata inviata una mail di conferma.");
                  })
                  .catch(() => {
                    Swal.fire("‚úÖ Prenotazione cancellata.\n‚ö†Ô∏è Errore nell'invio dell'email di conferma.");
                  });
              } else {
                Swal.fire("‚úÖ Prenotazione cancellata.");
              }

              // 3) rimuovi la riga dalla tabella
              riga.remove();

              // se la tabella √® vuota, mostra messaggio
              const tbody = lista.querySelector("tbody");
              if (tbody && tbody.children.length === 0) {
                lista.innerHTML = `<p class="text-warning">Non ci sono altre prenotazioni per <strong>${emailDest}</strong>.</p>`;
              }

            } catch (err) {
              console.error("Errore cancellazione:", err);
              Swal.fire("‚ùå Errore nella cancellazione della prenotazione.");
              btn.disabled = false;
              btn.innerHTML = oldHtml;
            }
          });
        });

      } catch (error) {
        console.error("Errore lettura Firestore:", error);
        lista.innerHTML = `<p class="text-danger">Errore durante il caricamento delle prenotazioni.</p>`;
      }
    });
  </script>
  <!-- ======= finmi Script ricerca + cancellazione ======= -->

</body>

</html>